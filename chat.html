<html>

<head></head>

<body>
    <h1>Nova Chat</h1>
    <textarea id='messages'></textarea>
    <input id='new-message'>
    <button id='send' onclick='send()'>SEND</button>
</body>

<style>
    body {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding-top: 5em;
        max-width: 50em;
        margin: 0 auto;
    }

    h1 {
        text-align: center;
    }

    button {
        margin: 1em;
        padding: 1em 2em;
    }

    #messages,
    #new-message {
        width: 50em;
        margin: 1em;
        padding: 1em;
    }

    #messages {
        height: 20em;
        resize: none;
    }
</style>

<script>
    var socket
    var inp

    document.addEventListener('DOMContentLoaded', async () => {
        const p = document.getElementById('messages')
        inp = document.getElementById('new-message')

        await fetch('http://localhost:8080/user/user1/subscribe',
            { method: 'POST', body: '{"topic":"mytopic"}' }
        )

        socket = new WebSocket("ws://localhost:8080/user/user1/ws")

        socket.onmessage = event => {
            const data = JSON.parse(event.data)
            const formatted = `${data.user}: ${data.payload}\n`
            p.value += formatted
        }
    })

    function send() {
        socket.send(JSON.stringify(
            { 'topic': 'mytopic', 'payload': inp.value }))
        inp.value = ''
    }
</script>

</html>